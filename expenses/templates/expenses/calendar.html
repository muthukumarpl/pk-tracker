{% extends 'expenses/base.html' %}

{% block content %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container py-3 px-0 px-md-1">
    <div class="card calendar-card shadow-lg p-1 p-md-4 rounded-4">
        <div class="piggy-bank">ЁЯР╖</div>
        <h3 class="text-center mb-4 fw-bold calendar-title">Financial Tracker Calendar ЁЯУЕ</h3>

        <div class="calendar-wrapper shadow-sm rounded-4">
            <div id='calendar'></div>
        </div>
    </div>
</div>

<style>
    /* рокро┐ройрпНройрогро┐ (Background) - Glass Effect */
    .calendar-card {
        background: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        position: relative;
    }

    .calendar-title {
        color: #ffffff;
        text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
    }

    /* роХро╛ро▓рогрпНроЯро░рпН роХроЯрпНроЯроЩрпНроХро│рпН (Grid) */
    #calendar {
        background: #ffffff;
        border-radius: 15px;
        padding: 10px;
    }

    /* роЕрогрпНроЯро░рпНро▓рпИройрпН роирпАроХрпНроХрпБродро▓рпН */
    .fc-daygrid-day-number, .fc-col-header-cell-cushion {
        text-decoration: none !important;
        color: #1e3c72 !important;
        font-weight: 700;
        font-size: 0.85rem; /* рокрпЛройро┐ро▓рпН роОрогрпНроХро│рпН роЪро░ро┐ропро╛роХродрпН родрпЖро░ро┐роп */
    }

    /* роорпКрокрпИро▓ро┐ро▓рпН роХроЯрпНроЯроЩрпНроХро│рпН роЪро┐ро▒ро┐ропродро╛роХродрпН родрпЖро░ро┐ропро╛рооро▓рпН роЗро░рпБроХрпНроХ роЙропро░роорпН (Height) */
    .fc .fc-view-harness {
        min-height: 450px; /* рокрпЛройро┐ро▓рпН роХро╛ро▓рогрпНроЯро░рпН роХроЯрпНроЯроЩрпНроХро│рпН роЙропро░рооро╛роХ роЗро░рпБроХрпНроХрпБроорпН */
    }

    /* роИро╡рпЖройрпНроЯрпНроХро│рпН (Expense/Income) роЪро┐ро▒ро┐ропродро╛роХродрпН родрпЖро░ро┐роп */
    .fc-daygrid-event {
        font-size: 0.65rem !important; /* рокрпЛройро┐ро▓рпН роЯрпЖроХрпНро╕рпНроЯрпН роХроЯрпН роЖроХро╛рооро▓рпН роЗро░рпБроХрпНроХ */
        padding: 1px !important;
    }

    .fc-col-header-cell {
        background: #f8f9fa;
    }

    /* роорпКрокрпИро▓рпН Toolbar рокроЯрпНроЯройрпНроХро│рпН */
    @media (max-width: 768px) {
        .fc-toolbar-title { font-size: 0.9rem !important; }
        .fc-button { padding: 0.2em 0.4em !important; font-size: 0.75rem !important; }
        .piggy-bank { display: none; } /* рокрпЛройро┐ро▓рпН роЯрпИроЯрпНроЯро┐ро▓рпИ рооро▒рпИроХрпНроХро╛рооро▓рпН роЗро░рпБроХрпНроХ */
    }

    .piggy-bank {
        position: absolute;
        top: 15px;
        right: 30px;
        font-size: 2.5rem;
        animation: bounce 2s infinite;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            // роЗрокрпНрокрпЛродрпБ рокрпЛройрпН рооро▒рпНро▒рпБроорпН роЯрпЖро╕рпНроХрпНроЯро╛рокрпН роЗро░рогрпНроЯро┐ро▓рпБроорпН 'dayGridMonth' (роХроЯрпНроЯроЩрпНроХро│рпН) родро╛ройрпН ро╡ро░рпБроорпН
            initialView: 'dayGridMonth',

            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,dayGridWeek'
            },

            events: {{ events|safe }},
            height: 'auto',
            navLinks: true,

            dateClick: function(info) {
                Swal.fire({
                    title: 'Add Entry',
                    text: "Date: " + info.dateStr,
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonText: 'ЁЯЪА Add Now'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = "{% url 'expense_list' %}";
                    }
                });
            },

            eventClick: function(info) {
                let eventId = info.event.id;
                let eventType = info.event.extendedProps.type;

                Swal.fire({
                    title: info.event.title,
                    text: "Manage this entry",
                    showDenyButton: true,
                    showCancelButton: true,
                    confirmButtonText: 'тЬПя╕П Edit',
                    denyButtonText: 'ЁЯЧСя╕П Delete'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = eventType === 'expense' ? `/edit/${eventId}/` : `/expenses/`;
                    } else if (result.isDenied) {
                        window.location.href = eventType === 'expense' ? `/delete/${eventId}/` : `/delete-income/${eventId}/`;
                    }
                });
            }
        });
        calendar.render();
    });
</script>
{% endblock %}