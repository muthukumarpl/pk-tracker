{% extends 'expenses/base.html' %}

{% block content %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container py-3 px-1">
    <div class="card calendar-card shadow-lg p-2 p-md-4 rounded-4">
        <div class="piggy-bank">ЁЯР╖</div>

        <h3 class="text-center mb-4 fw-bold calendar-title">Financial Journey Calendar ЁЯУЕ</h3>

        <div class="calendar-wrapper shadow-sm rounded-4">
            <div id='calendar'></div>
        </div>
    </div>
</div>

<style>
    /* 1. рокро┐ройрпНройрогро┐ (Background) - Glass Effect */
    .calendar-card {
        background: rgba(255, 255, 255, 0.2) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        position: relative;
    }

    .calendar-title {
        color: #ffffff;
        text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
    }

    /* 2. роХро╛ро▓рогрпНроЯро░рпН ро╕рпНроЯрпИро▓рпН - Clean & Modern */
    #calendar {
        background: #ffffff;
        border-radius: 15px;
        padding: 15px;
        color: #333;
    }

    /* роЕрогрпНроЯро░рпНро▓рпИройрпН роирпАроХрпНроХрпБродро▓рпН (Fixing Underline Issue) */
    .fc-daygrid-day-number, .fc-col-header-cell-cushion {
        text-decoration: none !important; /* роЕрогрпНроЯро░рпНро▓рпИройрпИ роирпАроХрпНроХрпБроорпН */
        color: #1e3c72 !important;
        font-weight: 700;
    }

    /* роХро┐ро┤роорпИроХро│рпН (Sun, Mon...) */
    .fc-col-header-cell {
        background: #f8f9fa;
        padding: 10px 0;
    }

    /* роЗройрпНро▒рпИроп родрпЗродро┐ */
    .fc-day-today {
        background: rgba(18, 194, 233, 0.1) !important;
        border: 2px solid #12c2e9 !important;
    }

    /* 3. роЕройро┐роорпЗро╖ройрпН */
    .piggy-bank {
        position: absolute;
        top: 15px;
        right: 30px;
        font-size: 2.5rem;
        animation: bounce 2s infinite;
        z-index: 10;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    /* роИро╡рпЖройрпНроЯрпН роЯро┐роЪрпИройрпН */
    .fc-event {
        border-radius: 6px !important;
        padding: 3px 8px !important;
        font-size: 0.85rem !important;
        border: none !important;
        cursor: pointer;
        transition: 0.2s ease;
    }

    .fc-event:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* роорпКрокрпИро▓рпН рооро╛ро▒рпНро▒роЩрпНроХро│рпН */
    @media (max-width: 768px) {
        .fc-toolbar-title { font-size: 1rem !important; }
        .fc-button { padding: 0.3em 0.5em !important; font-size: 0.8rem !important; }
        .piggy-bank { font-size: 1.8rem; top: 10px; right: 15px; }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: window.innerWidth < 768 ? 'listMonth' : 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: window.innerWidth < 768 ? '' : 'dayGridMonth,dayGridWeek'
            },
            events: {{ events|safe }},
            height: 'auto',
            navLinks: true, // родрпЗродро┐ропрпИ роХро┐ро│ро┐роХрпН роЪрпЖропрпНроп роЕройрпБроородро┐роХрпНроХрпБроорпН

            // родрпЗродро┐ропрпИ роХро┐ро│ро┐роХрпН роЪрпЖропрпНродрпБ роЖроЯрпН роЪрпЖропрпНродро▓рпН
            dateClick: function(info) {
                Swal.fire({
                    title: 'Add Entry',
                    text: "Selected Date: " + info.dateStr,
                    icon: 'info',
                    showCancelButton: true,
                    confirmButtonText: 'ЁЯЪА Go to Tracker',
                    confirmButtonColor: '#12c2e9'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = "{% url 'expense_list' %}";
                    }
                });
            },

            eventClick: function(info) {
                let eventId = info.event.id;
                let eventType = info.event.extendedProps.type;

                Swal.fire({
                    title: info.event.title,
                    text: "Manage this record",
                    showDenyButton: true,
                    showCancelButton: true,
                    confirmButtonText: 'тЬПя╕П Edit',
                    denyButtonText: 'ЁЯЧСя╕П Delete',
                    confirmButtonColor: '#ffc107',
                    denyButtonColor: '#f64f59'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = eventType === 'expense' ? `/edit/${eventId}/` : `/expenses/`;
                    } else if (result.isDenied) {
                        window.location.href = eventType === 'expense' ? `/delete/${eventId}/` : `/delete-income/${eventId}/`;
                    }
                });
            }
        });
        calendar.render();
    });
</script>
{% endblock %}
