{% extends 'expenses/base.html' %}

{% block content %}
<style>
    /* à®•à®¾à®°à¯à®Ÿà¯ à®¸à¯à®Ÿà¯ˆà®²à¯ */
    .card-glass {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 22px;
        color: #ffffff !important;
        margin-bottom: 25px;
    }

    /* à®…à®©à¯ˆà®¤à¯à®¤à¯ à®à®´à¯à®¤à¯à®¤à¯à®•à¯à®•à®³à¯à®®à¯ à®µà¯†à®³à¯à®³à¯ˆ */
    h2, h3, h4, h5, h6, p, span, label, td, th, div {
        color: #ffffff !important;
    }

    .text-info-bright { color: #0dcaf0 !important; font-weight: bold; }
    .text-success-bright { color: #38ef7d !important; font-weight: bold; }
    .text-danger-bright { color: #ff4b2b !important; font-weight: bold; }

    /* à®‡à®©à¯à®ªà¯à®Ÿà¯ à®®à®±à¯à®±à¯à®®à¯ à®ªà¯‡à®Ÿà¯à®œà¯ */
    .member-badge {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.4);
        color: #ffffff !important;
        padding: 6px 16px;
        border-radius: 50px;
        display: inline-block;
        margin: 4px;
    }

    .form-control-pk {
        background: rgba(255,255,255,0.1) !important;
        border: 1px solid rgba(255,255,255,0.3) !important;
        color: #ffffff !important;
        border-radius: 10px;
    }

    /* TABLE TEXT FIX: à®Ÿà¯‡à®ªà®¿à®³à¯à®•à¯à®•à¯à®³à¯ à®‡à®°à¯à®•à¯à®•à¯à®®à¯ à®Ÿà¯†à®•à¯à®¸à¯à®Ÿà¯ à®ªà®³à®¿à®šà¯à®šà¯†à®©à¯à®±à¯ à®¤à¯†à®°à®¿à®¯ */
    .table {
        --bs-table-bg: transparent !important;
        --bs-table-color: #ffffff !important;
        width: 100%;
        margin-bottom: 1rem;
        vertical-align: middle;
    }

    .table td, .table th {
        color: #ffffff !important;
        background-color: transparent !important;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 12px;
    }

    .table thead th {
        color: #0dcaf0 !important; /* à®¤à®²à¯ˆà®ªà¯à®ªà¯ à®®à®Ÿà¯à®Ÿà¯à®®à¯ Cyan à®¨à®¿à®±à®®à¯ */
        border-bottom: 2px solid rgba(13, 202, 240, 0.3);
    }

    .btn-action {
        border-radius: 50px; font-size: 0.75rem; padding: 5px 12px; font-weight: bold; text-decoration: none !important;
    }
    .btn-outline-white { border: 1.5px solid #ffffff; color: #ffffff !important; }
</style>

<div class="row">
    <div class="col-lg-4">
        <div class="card-glass border-top border-info border-4">
            <h2 class="fw-bold mb-1">{{ group.name }}</h2>
            <p class="small opacity-75">Type: {{ group.get_group_type_display }}</p>

            <h6 class="fw-bold mb-3 mt-4">ğŸ‘¥ Members ({{ group.members.count }})</h6>
            <div class="mb-4">
                {% for member in group.members.all %}
                    <span class="member-badge">@{{ member.username }}</span>
                {% endfor %}
            </div>

            <form method="POST">
                {% csrf_token %}
                <div class="input-group mb-2">
                    <input type="text" name="username" class="form-control form-control-pk" placeholder="Add Username..." required>
                    <button type="submit" name="add_member" class="btn btn-info text-white fw-bold">ADD</button>
                </div>
            </form>
        </div>

        <div class="card-glass border-top border-success border-4">
            <h6 class="text-success-bright mb-3">ğŸ“Š Settlement Status</h6>
            {% for s in settlements %}
            <div class="d-flex justify-content-between align-items-center mb-2 p-3" style="background: rgba(255,255,255,0.05); border-radius: 12px;">
                <span class="fw-bold">@{{ s.user.username }}</span>
                <span class="{% if s.balance < 0 %}text-danger-bright{% else %}text-success-bright{% endif %}">
                    {% if s.balance < 0 %} Owe: â‚¹{{ s.balance|floatformat:2|cut:"-" }} {% else %} Get: â‚¹{{ s.balance|floatformat:2 }} {% endif %}
                </span>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card-glass border-top border-info border-4">
            <h5 class="text-info-bright mb-3">ğŸ’¸ Add Shared Expense</h5>
            <form method="POST">
                {% csrf_token %}
                <div class="row g-2">
                    <div class="col-md-6">
                        <input type="text" name="title" class="form-control form-control-pk" placeholder="What for?" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" name="amount" class="form-control form-control-pk" placeholder="Amount" required>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" name="add_group_expense" class="btn btn-info w-100 rounded-pill text-white fw-bold">SAVE</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="card-glass shadow">
            <h5 class="text-info-bright mb-4">ğŸ“œ Group Transactions</h5>
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Paid By</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ge in group_expenses %}
                        <tr>
                            <td class="small opacity-75">{{ ge.date|date:"d M" }}</td>
                            <td class="text-info-bright">@{{ ge.paid_by.username }}</td>
                            <td class="fw-bold text-white">{{ ge.title }}</td>
                            <td class="text-success-bright">â‚¹{{ ge.amount }}</td>
                            <td>
                                {% if ge.paid_by == request.user %}
                                <div class="d-flex gap-2">
                                    <button class="btn-action btn-outline-white bg-transparent">EDIT</button>
                                    <button class="btn-action btn-outline-white bg-transparent text-danger border-danger">DEL</button>
                                </div>
                                {% else %}
                                <span class="opacity-50 small">Locked</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center opacity-50 py-5">No transactions recorded yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}